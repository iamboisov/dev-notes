---
description: Работа со старыми скриптами
---

# Устаревшее слово var

## Область видимости

Область видимости для `var` — функция или сам скрипт. У переменных объявленных с помощью `var` область видимости не ограничивается блоком кода.

```javascript
if (true) {
  var test = true; // используем var вместо let
}

console.log(test) // true
```

{% hint style="info" %}
`var` игнорирует блоки кода и мы получаем глобальную переменную.
{% endhint %}

Это так же работает и для циклов.

Это происходит потому, что на заре развития JavaScript блоки кода не имели лексического окружения.

## Повторное объявление

Используя var, можно сколько угодно раз объявлять переменную и ошибки не будет.

Повторные `var` игнорируются:

```javascript
var user = "Пётр";

var user; // ничего не делает, переменная объявлена раньше
// ...нет ошибки

alert(user); // Пётр
```

Если дополнительно присвоить значение, то переменная примет новое значение.

Переменные, объявленные с помощью var, обрабатываются в начале выполнения функции. То есть они считаются объявленными с самого начала функции вне зависимости от того, где они были объявлены (за исключением вложенных функций).

```javascript
function sayHi() {
  name = "John";
  console.log(name)
  var name
}

sayHi()
```

Блочная область видимости игнорируется:

```javascript
function sayHi() {
  phrase = "Привет"; // (*)

  if (false) {
    var phrase;
  }

  console.log(phrase);
}
sayHi();
```

{% hint style="info" %}
Такое поведение называется "hoisting" (всплытие, поднятие). Все объявления переменных `var` "всплывают" в самый верх.
{% endhint %}

Объявления переменных "всплывают", но не присваивания.

```javascript
function sayHi() {
  if (false) {
    var phrase = "Привет";
  }

  console.log(phrase);
}
sayHi(); // undefined
```

```javascript
function sayHi() {
  var phrase // Объявление переменной срабатывает в начале
  console.log(phrase); // undefined
  phrase = "Привет"; // Присваивание
}
sayHi();
```

## IIFE

Поскольку `var` не имел блочной области видимости, разработчики придумали способ ее эмуляции.

```javascript
(function() {
  var message = "Привет";
  console.log(message); // Привет
})();

console.log(message) // message is not defined
```

Здесь создается и немедленно вызывается Function Expression. Эту функцию невозможно объявить с помощью Function Declaration потому, что JavaScript не сможет ее сразу вызвать или будет выведет ошибку об отсутствии имени в функции (если анонимная функция).

Помимо круглых скобок существуют и другие способы сообщить JavaScript, что мы имеем в виду Function Expression:

```javascript
(function() {
  console.log("Круглые скобки вокруг функции");
})();

(function() {
  console.log("Круглые скобки вокруг всего выражения");
}());

!function() {
  console.log("Выражение начинается с логического оператора НЕ");
}();

+function() {
  console.log("Выражение начинается с унарного плюса");
}();
```

{% hint style="danger" %}
В настоящее время необходимости писать подобный код нет.
{% endhint %}
